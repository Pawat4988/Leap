from dwave.system import LeapHybridBQMSampler, LeapHybridCQMSampler, LeapHybridDQMSampler
import dwave.inspector
from collections import defaultdict
import networkx as nx
from dimod.binary import BinaryQuadraticModel
from dimod import ConstrainedQuadraticModel, Integer
import dimod
import numpy
from hybrid.utils import sample_as_dict
import time
from collect import Collect
collect = Collect()
import pickle
import random
from dimod import ExactSolver


random.seed(2)

genProblem1 = []
genProblem2 = []

upperLimit = 4000
amountWanted = 5000
constantTotal = 5_924_917
eachSubsetTotal = constantTotal
genNum = random.randint(1,upperLimit)
while eachSubsetTotal > genNum:
    if len(genProblem1) == (amountWanted/2)-1:
        break
    genProblem1.append(genNum)
    eachSubsetTotal -= genNum
    genNum = random.randint(1,upperLimit)
if eachSubsetTotal > 0:
    genProblem1.append(eachSubsetTotal)

eachSubsetTotal = constantTotal
genNum = random.randint(1,upperLimit)
while eachSubsetTotal > genNum:
    if len(genProblem2) == (amountWanted/2)-1:
        break
    genProblem2.append(genNum)
    eachSubsetTotal -= genNum
    genNum = random.randint(1,upperLimit)
if eachSubsetTotal > 0:
    genProblem2.append(eachSubsetTotal)

final = genProblem1 + genProblem2

# with open (f'problemWith{amountWanted}Num', 'rb') as fp:
#     final = pickle.load(fp)

print(len(final))
print(sum(final))



sets = [
        # [25, 7, 13, 31, 42, 17, 21, 10],
        # [30, 2, 26, 12, 41, 27, 1, 11, 48, 11, 35, 33, 23],
        # [33, 50, 27, 31, 8, 9, 28, 14, 33, 7, 27, 28, 7, 42, 13, 33, 2, 8],
        # [5, 9, 14, 2, 7, 35, 14, 28, 26, 16, 44, 27, 12, 40, 1, 49, 39, 24, 8],
        # [9, 21, 17, 20, 14, 28, 4, 36, 31, 13, 16, 41, 56, 1, 35, 50, 31, 12, 20, 2, 31, 12],
        # [3, 41, 7, 1, 44, 4, 10, 25, 30, 19, 16],
        # [3, 26, 6, 23, 7, 5],
        # [2, 35, 11, 11, 9, 8, 23, 28, 9],
        # [4, 8, 7, 10, 3, 18, 9, 17, 28, 17, 25, 11, 8, 24, 43, 1, 30, 29],
        # [20, 18, 38, 42, 26, 45, 12, 13, 29, 23, 34, 23, 19, 2, 11, 9, 44, 25, 29, 46, 2, 35, 34, 21],
        # [35, 40, 36, 34, 1, 43, 34, 31, 48, 31, 27, 27, 46, 8, 12, 8, 1, 22, 19, 31, 40, 18, 1, 44, 29],
        # [9, 20, 20, 41, 22, 11, 4, 4, 3, 11, 15, 37, 22, 27],
        # [5, 23, 47, 44, 7, 8, 28, 19, 47, 24, 45, 21, 3, 15, 38, 2, 35, 35, 20, 29, 26, 48, 27, 21, 19, 6],
        # [28, 5, 12, 44, 29, 26, 44, 22, 27, 7, 3, 31, 30, 40, 50, 1, 21],
        # [8, 48, 3, 10, 23, 5, 21],
#         [11519, 6030, 3443, 11531, 11282, 9775, 9931, 2669, 8366, 2704, 4616, 4282, 11369, 416, 3042, 10102, 1739, 4756, 8554, 10670, 6093, 10149, 5356, 4299, 1956, 4121, 2961, 4603, 8948, 8701, 8116, 5530, 8952, 8712, 1846, 10347, 11209, 3031, 9386, 9911, 3134, 8220, 3855, 9114, 2788, 1114, 4073, 2542, 9367, 457, 2727, 10220, 11976, 8276, 7079, 10367, 2399, 5070, 2857, 2602, 4824, 8442, 1793, 10914, 6590, 7583, 8949, 10498, 1105, 2554, 3881, 3172, 3546, 6425, 2899, 9354, 3905, 5714, 11798, 586, 228, 3514, 2978, 1468, 11995, 4489, 6306, 1689, 3786, 5959, 8551, 6715, 2012, 10125, 2535, 6502, 11748, 5779, 1693, 9624, 5170, 8366, 2496, 4636, 9687, 3731, 66, 9899, 6821, 8457, 5367, 9286, 9783, 10586, 7645, 2324, 219, 3422, 1777, 2795, 10280, 5417, 9832, 3068, 6258, 8447, 6074, 8232, 5672, 2135, 4051, 11131, 5610, 9899, 4882, 2520, 8319, 5902, 6262, 7077, 4675, 5038, 6491, 7039, 5784, 2398, 2080, 4506, 3496, 6155, 934, 6832, 10970, 10774, 1970, 6718, 8958, 6906, 9273, 8386, 6804, 1356, 2679, 4105, 11961, 4811, 7899, 2260, 5480, 11108, 10181, 4268, 1800, 8305, 1424, 7218, 8398, 5584, 7974, 11361, 10946, 2174, 4478, 11281, 2098, 4480, 915, 8336, 2989, 2649, 9430, 4699, 7919, 2064, 11666, 690, 7774, 11374, 3793, 590, 3307, 4531, 6759, 5758, 7003, 8793, 7016, 3303, 4182, 10548, 11425, 5261, 5599, 6572, 10052, 7539, 8929, 3304, 1515, 8756, 3591, 4786, 8046, 9741, 11668, 81, 3071, 4705, 11018, 8157, 1204, 3432, 11858, 472, 2184, 1103, 3470, 1929, 6355, 
# 3944, 3977, 5628, 2602, 7311, 3485, 4908, 2131, 9673, 248, 2447, 6769, 2747, 4191, 7271, 9003, 10351, 11618, 10652, 3419, 6576, 2427, 5811, 6061, 10465, 1420, 5581, 11909, 4084, 1892, 7884, 5372, 7616, 2271, 425, 5179, 4973, 7454, 2854, 11114, 6003, 7529, 8346, 2044, 9558, 6056, 116, 11533, 5731, 6977, 857, 4950, 5005, 9080, 5292, 2839, 3631, 10613, 5265, 10046, 8358, 10937, 3051, 6969, 10505, 4965, 5102, 9346, 4685, 9986, 7028, 11463, 882, 7942, 6908, 816, 2288, 2931, 3788, 3615, 
# 1858, 4371, 10252, 8697, 10048, 10998, 7072, 2894, 6276, 5848, 1621, 1608, 9268, 8893, 681, 2193, 7260, 11950, 8313, 10152, 7802, 3304, 11537, 1150, 9815, 6502, 5285, 5436, 8076, 621, 7113, 6716, 10424, 9238, 947, 5548, 1492, 2288, 229, 7776, 6412, 10278, 7415, 4345, 1319, 8261, 4526, 8298, 6998, 998, 2450, 5028, 4798, 4766, 4677, 7126, 8064, 8538, 6875, 1921, 3405, 10652, 7859, 3525, 6453, 11094, 6304, 9139, 282, 5757, 5409, 9185, 1541, 8195, 6031, 350, 9512, 3722, 7087, 8115, 6175, 2610, 468, 3853, 10676, 11680, 2774, 11032, 11911, 4936, 9682, 5099, 7185, 6652, 7814, 9672, 7540, 5426, 9152, 8958, 8538, 9697, 9153, 4539, 4627, 2133, 7365, 
# 6859, 7713, 9662, 10425, 9275, 10289, 8892, 5860, 7085, 5030, 11745, 1321, 1588, 7039, 8383, 3757, 5219, 11609, 5273, 3259, 8715, 4668, 6402, 2278728, 9514, 7473, 5638, 7662, 8264, 10782, 9116, 1173, 5084, 7702, 7276, 8265, 2537, 1988, 3321, 10329, 2353, 9415, 7216, 7145, 7944, 11489, 205, 10592, 7273, 10121, 5368, 9425, 9436, 1825, 3840, 9722, 7908, 1380, 124, 3703, 11746, 5173, 4777, 10572, 10062, 6633, 11309, 11020, 9965, 4895, 1023, 10259, 7440, 5850, 3140, 4792, 8910, 3569, 11745, 7043, 3164, 9885, 5552, 2953, 4438, 11958, 4128, 9859, 9189, 8648, 3822, 5073, 331, 6981, 7377, 1383, 9960, 2657, 9671, 2895, 4487, 7417, 2218, 11575, 10786, 7570, 5097, 11890, 4393, 146, 9186, 2807, 2292, 840, 1836, 7698, 7447, 7102, 5569, 7030, 6852, 10340, 9195, 1114, 3231, 3324, 3042, 2556, 3369, 327, 2232, 5939, 
# 5337, 6910, 3912, 2457, 4900, 10566, 873, 7212, 1773, 4161, 10572, 7661, 8193, 1840, 9656, 9267, 2025, 5741, 7905, 8297, 5966, 101, 3733, 10105, 4010, 11305, 7264, 3832, 4766, 10190, 11576, 4169, 2144, 3366, 4687, 2610, 3216, 7264, 11853, 8195, 6650, 2699, 1401, 1178, 2923, 5887, 2978, 190, 11129, 7618, 9676, 7760, 443, 9700, 3890, 4111, 4169, 6751, 11401, 9814, 10819, 10935, 497, 1330, 8648, 2739, 5127, 9098, 2694, 3037, 1217, 5045, 1323, 9024, 3830, 2661, 4167, 10939, 1205, 5318, 5849, 9342, 7249, 10387, 4475, 9639, 10850, 4858, 9344, 8877, 1039, 8637, 3574, 10660, 4231, 4337, 8679, 538, 8301, 3172, 2544, 10914, 808, 2372, 351, 10413, 4728, 4538, 4851, 7273, 1307, 8853, 7286, 10467, 7774, 4623, 11494, 28, 5086, 21, 9148, 1432, 2574, 4086, 3387, 3033, 3210, 5378, 10077, 4394, 10519, 2447, 680, 633, 1063, 6580, 11227, 9926, 3753, 6411, 3509, 9779, 11885, 74, 1026, 10224, 2140, 1831, 5995, 10290, 5941, 81, 4371, 11888, 1974, 6943, 7484, 6983, 445, 8628, 2966, 269, 5783, 2572, 10030, 8709, 8621, 8156, 11763, 2760, 1395, 3136, 5797, 5433, 8054, 6821, 8056, 4052, 7401, 4700, 5882, 6308, 2349, 6890, 7982, 8177, 3073, 4930, 3361, 2384, 8956, 7563, 7888, 5026, 10721, 4880, 4497, 9446, 7048, 2497, 8847, 11176, 4070, 11643, 11255, 6167, 1590, 1188, 2310, 3759, 5267, 8995, 2456, 5560, 
# 6759, 1918, 8895, 2914, 1780, 8098, 5828, 2736, 7566, 10794, 9829, 10757, 8752, 1797, 647, 6673, 2271, 8346, 5402, 4380, 4339, 2147, 3588, 7329, 2709, 3389, 9799, 5044, 11844, 581, 6309, 6000, 11517, 10863, 1870, 276, 4034, 3386, 2477, 10674, 5842, 5694, 10828, 7420, 3249, 8854, 8457, 6211, 10562, 7735, 2202, 10544, 5057, 
# 8713, 4263, 1916, 9712, 8741, 3921, 10677, 10738, 9253, 11224, 11939, 9003, 8563, 5665, 2086, 8137, 9994, 11590, 11619, 3612, 8771, 153, 11664, 5997, 2812, 4992, 
# 1966, 715, 2741, 6809, 8442, 1922, 10240, 5223, 1963, 7212, 6870, 9691, 10059, 9754, 10706, 7581, 6535, 7352, 11442, 6851, 8068, 4149, 11057, 1020, 5009, 10745, 5797, 11436, 398, 5862, 2093, 8409, 11575, 10770, 7528, 5734, 6718, 4221, 731, 7233, 1904, 7653, 4665, 4682, 6209, 6574, 6675, 7601, 2285857],
# [3181, 3746, 6393, 10081, 4166, 7570, 6043, 9737, 3663, 6312, 10508, 8447, 2877, 9118, 2194, 10865, 7069, 4344, 933, 8838, 4271, 8843, 5993, 1690, 5836, 2833, 11056, 11464, 7856, 5589, 6202, 342, 11562, 3721, 3548, 9293, 1099, 1683, 8883, 1533, 10606, 2258, 5523, 3146, 1073, 159, 7809, 2999, 5597, 4721448, 806, 797, 11976, 2210, 7818, 5793, 4977, 2398, 9020, 7491, 8125, 10715, 7692, 5396, 4493, 5808, 10576, 10334, 11404, 3588, 3415, 9873, 9869, 2953, 5709, 3302, 6415, 9745, 11562, 
# 7312, 3397, 3008, 4666, 732, 4752, 2491, 8504, 492, 11156, 3501, 4322, 3835, 11557, 2764, 2490, 5141, 7181, 5177, 11282, 4701980],
# [260, 11786, 2148, 4, 8804, 9478, 10176, 9310, 5524, 10081, 7262, 11953, 8697, 760, 766, 4227, 11263, 10106, 3366, 2711, 6483, 245, 3480, 6918, 8902, 7847, 1012, 
# 1414, 5629, 3446, 2691, 4655, 4355, 875, 372, 9563, 9466, 10802, 9443, 6753, 4709, 10620, 449, 11011, 10985, 1178, 221, 3783, 8407, 2968, 10410, 4704, 2208, 2216, 3140, 11282, 4716, 3261, 7190, 5069, 9415, 11354, 11240, 383, 608, 10024, 9705, 5492, 2626, 9001, 11895, 11863, 10553, 4104, 5947, 5282, 11175, 8911, 6392, 6839, 8318, 9794, 11381, 6606, 4308, 7663, 2985, 6777, 9807, 11951, 221, 6400, 2437, 8607, 1061, 3449, 10794, 5833, 4966, 3767, 11558, 10793, 5587, 1388, 5087, 1251, 1971, 9562, 2167, 190, 8042, 1780, 9561, 10628, 1488, 8117, 4039, 7877, 6459, 6882, 7825, 4237, 2548, 2268, 11665, 5306, 7551, 11879, 7213, 5562, 11595, 6909, 11907, 9521, 9715, 6845, 9300, 8581, 7277, 1102, 11663, 10372, 5797, 10069, 3826, 9282, 9360, 209, 2461, 2016, 7441, 10746, 4897, 2476, 2192, 2158, 1419, 7135, 10793, 9145, 1214, 11498, 9399, 4569, 10034, 207, 6139, 3627, 154, 3818, 2590, 2545, 7369, 3132, 6000, 1089, 984, 8409, 2013, 10617, 4069, 2857, 5485, 5687, 1918, 8775, 5235, 6626, 2800, 4319, 4901, 1401, 7166, 9593, 5308, 10626, 1802, 9629, 10620, 1554, 9140, 11486, 3952, 11802, 5008, 131, 4891, 9465, 10806, 3518, 1469, 10678, 
# 2844, 4149, 5991, 2911, 10346, 4786, 4543, 9068, 8433, 8551, 8184, 3067, 11819, 7727, 11947, 3289, 5796, 4883, 6675, 2741, 3091, 3510, 5471, 1089, 2695, 4494, 5985, 3091, 2978, 4133, 2511, 6709, 5679, 441, 11784, 7763, 7731, 1227, 8372, 3791, 3728, 8006, 10844, 5022, 9029, 3256, 9331, 5726, 10802, 7068, 9725, 4476, 2307, 4042, 10177, 6273, 10894, 8352, 2373, 7432, 5163, 11055, 4322, 6406, 9281, 4957, 1564, 1521, 10201, 8672, 4261, 7810, 8901, 4883, 10848, 10843, 1734, 5043, 3020, 107, 296, 9564, 10512, 1242, 9709, 8585, 7002, 609, 10910, 11059, 5510, 10836, 7781, 3732, 7289, 166, 7536, 11139, 9815, 5849, 2201, 2266, 11616, 6552, 2689, 6167, 2548, 6582, 8858, 5622, 7219, 207, 8668, 11283, 11524, 7024, 1843, 11690, 9584, 6402, 5108, 7738, 1407, 2756, 445, 9104, 7538, 4384, 6281, 9931, 3253, 96, 3389, 
# 1999, 4477, 8989, 5834, 7037, 6343, 7438, 4947, 9337, 6716, 1232, 10653, 11630, 7225, 2394, 6357, 7519, 7971, 11415, 10639, 172, 2297, 1710, 8254, 1394, 8972, 1247, 4796, 10254, 9668, 9077, 1431, 2179, 3532, 8793, 955, 5117, 4259, 6429, 2064, 7973, 2368, 1408, 10266, 5950, 33, 10295, 1753, 6759, 612, 9775, 890, 11536, 3651, 479, 4641, 11559, 481, 11201, 1815, 2352, 11618, 10061, 9691, 5128, 986, 10139, 64, 2376, 8670, 6503, 4768, 2377, 11894, 10685, 5115, 10288, 6813, 7792, 6425, 8965, 5616, 8294, 4432, 10723, 6861, 3751, 3331, 6038, 3103, 1472, 7156, 10161, 1748, 1691, 2723, 10581, 7095, 6933, 666, 6471, 4654, 8791, 6242, 3269, 9916, 8521, 5747, 3961, 2164, 157, 3262, 7211, 5627, 11683, 4793, 11421, 9649, 8955, 5125, 1746, 473, 4221, 6115, 6077, 409, 177, 2336, 3661, 575, 9443, 8180, 5493, 10349, 11672, 1843, 9167, 3346, 74, 7603, 5247, 989, 7396, 10326, 2069, 8951, 3007, 11917, 2884, 5951, 9066, 9569, 9260, 9695, 2651, 1991987, 691, 5136, 5496, 473, 10622, 1882, 5754, 8433, 7840, 9099, 14, 9062, 4749, 8335, 10655, 5829, 11971, 471, 5208, 3025, 1061, 6909, 11851, 1255, 2173, 596, 1016, 7850, 2559, 9607, 3471, 9593, 
# 10012, 5776, 4210, 57, 9344, 8889, 424, 4263, 8525, 11184, 9606, 3476, 6052, 5379, 395, 7104, 3490, 10858, 9654, 9118, 11827, 9755, 1679, 6633, 3150, 2097, 7928, 
# 1057, 197, 8577, 1125, 2715, 7938, 4591, 8772, 11554, 8138, 11788, 9067, 11634, 7093, 6982, 7512, 6267, 703, 8470, 7502, 3668, 11233, 6196, 11895, 8071, 11453, 11700, 2471, 10726, 10933, 10682, 11735, 6208, 1661, 5380, 1209, 8021, 1748, 1552, 11611, 8495, 5985, 494, 3385, 4449, 3343, 594, 5408, 10272, 6492, 3100, 6585, 4986, 4854, 9558, 7002, 8461, 11297, 6271, 2693, 9635, 705, 9273, 1774, 7052, 5736, 6846, 2481, 11285, 2701, 3369, 9612, 8712, 1531, 11544, 7430, 5502, 11275, 8769, 
# 7279, 2504, 1863, 5988, 9086, 3738, 2023, 7487, 709, 11790, 11298, 102, 6185, 6929, 4968, 3114, 3952, 4349, 1422, 9641, 7749, 3526, 2583, 11952, 11302, 9391, 2575, 3905, 1374, 9372, 10562, 6375, 7945, 8579, 10407, 2517, 4965, 4838, 5855, 6932, 3422, 6803, 2621, 11445, 7492, 2023, 4133, 1030, 11187, 714, 9403, 9188, 4443, 4595, 8575, 7978, 6404, 5605, 5028, 5680, 6032, 4215, 9654, 2059, 1308, 9350, 8912, 8750, 1612, 8320, 11176, 9835, 9789, 11323, 6742, 8915, 4718, 8690, 11338, 3091, 563, 9271, 5270, 4254, 7186, 5222, 3959, 2316, 8334, 292, 5928, 2894, 9775, 11522, 10354, 3022, 6288, 5391, 8095, 10783, 7859, 983, 5102, 5310, 5741, 9331, 4584, 3797, 9564, 5085, 1491, 1562, 5552, 10575, 5010, 2087, 9377, 11732, 2792, 2602, 2519, 832, 8987, 5151, 207, 6436, 4930, 10032, 2892, 10045, 2837, 11776, 4240, 3952, 8831, 10893, 11492, 4664, 1648, 8216, 5738, 6452, 3627, 152, 7423, 7940, 6849, 11645, 9607, 6656, 7968, 1254, 11116, 8509, 8845, 1657, 7049, 1397, 9213, 2624, 10233, 9717, 9657, 6802, 9265, 721, 548, 1440, 5156, 8675, 7743, 6542, 1783, 9288, 10941, 8370, 7362, 9693, 9544, 195, 9835, 4983, 10282, 101, 1261, 8695, 6150, 550, 846, 3503, 9505, 1912, 11329, 10948, 1629, 9683, 6786, 2747, 2303, 9011, 9861, 4165, 8309, 3797, 1742, 6446, 10577, 3045, 2940, 2341, 9551, 10982, 9164, 10402, 10357, 3156, 963, 4946, 3240, 5252, 9943, 10064, 4509, 10690, 2192, 6621, 3798, 1712, 10953, 3496, 8784, 3557, 6234, 835, 3968, 5871, 2133, 11960, 10535, 5295, 5300, 580, 2610, 4304, 4559, 1993, 3310, 11918, 752, 5813, 4043, 8103, 11210, 11181, 2441, 2089, 10208, 2427, 6456, 10927, 4746, 11895, 5136, 6880, 11733, 609, 
# 4583, 216, 5709, 11494, 542, 7818, 7308, 5444, 5111, 5591, 5562, 7102, 3025, 5458, 6883, 5220, 6857, 413, 9010, 4759, 9891, 1506, 5509, 4641, 5799, 10678, 11869, 
# 3585, 2524, 7448, 1599, 8580, 9799, 517, 2724, 9735, 928, 24, 5289, 579, 5056, 607, 10404, 9151, 8661, 8062, 10810, 6552, 10670, 4184, 2846, 2340, 3165, 10867, 10039, 10586, 11536, 2253, 11838, 11243, 1673, 1977, 8272, 6568, 7433, 7245, 7030, 1521, 2808, 1770, 8758, 6692, 4989, 11761, 5463, 11840, 10368, 522, 4697, 8013, 5390, 204, 11737, 10555, 9381, 8014, 1334, 2437, 10146, 1524, 547, 6698, 11170, 11624, 9678, 10962, 1925410]
        final
        ]
# set = [3,1,1,2,2,1]


sampler = LeapHybridBQMSampler()
# ----Loop here----
for problemNo, set in enumerate(sets):
    c = 0
    for i in set:
        c += i

    Q = defaultdict(int)

    for i in range(len(set)):
        for j in range(len(set)):
            Q[(i,i)] = set[i]*(set[i]-c)
            Q[(i,j)] = set[i]*set[j]
    print("Done Q matrix")
    # calculate here
    # response = sampler.sample_qubo(Q,time_limit=6)
    response = sampler.sample_qubo(Q)
    # response = ExactSolver().sample_qubo(Q)

    timimgInfo = response.info
    qpu_access_time = timimgInfo["qpu_access_time"]
    run_time = timimgInfo["run_time"]

    bestAnswer = 10000
    for sample, energy in response.data(fields=['sample','energy']):
        set0Total = 0
        set1Total = 0
        for key, value in sample.items():
            amount = set[key]
            if value == 0:
                set0Total += amount
            elif value == 1:
                set1Total += amount
        if set0Total == set1Total:
            print(sample)
            print(f"set0 total: {set0Total}",f"set1 total: {set1Total}","Valid")
        else:
            print(sample)
            print(f"set0 total: {set0Total}",f"set1 total: {set1Total}","Invalid")
        # get best ansewr
        diff = abs(set0Total - set1Total)
        if diff < bestAnswer:
            bestAnswer = diff

        # collect.addNumPartitionData(problemNo,sample,qpu_access_time,run_time,diff,energy)

# collect.saveData("numPartitionBQM")